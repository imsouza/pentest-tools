import socket
import thread

class TCPServer:
  def __init__(self, host, port):
    self.buffer_size = 1024
    self.socket_server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    self.socket_server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    self.socket_server.bind((host, port))

  def listen(self):
    self.socket_server.listen(5)
    print '[-] Waiting for connections'

    while 1:
      (client, address) = self.socket_server.accept()
      print '[+] Client connected: ' + address[0]
      thread_client = thread.start_new_thread(self.sync, (client, address))

  def sync(self, client, address):
    _return = client.recv(self.buffer_size)

    if _return == 'SYN':
      client.send('SYN-ACK')
      if _return == 'ACK':
          print '[-] Sync with remote client.'

    client.close()
      
server = TCPServer('localhost', 7171)
server.listen()

